# I. spring boot documentation

> **versiong :2.0.3.RELEASE**





# II. getting started 

## system requirements

> Spring Boot 2.0.3.RELEASE需要Java 8 or 9和Spring Framework 5.0.7.RELEASE或以上。 为Maven 3.2+和Gradle 4提供了明确的构建支持。



## installing spring boot

> *  **Spring Boot可以用于“经典”Java开发工具或作为命令行工具安装。 无论哪种方式，你需要Java SDK v1.8或更高。** 
>
> * **install** 
>   * maven
>   * gradle



### installation instructions for the java developer 

> **添加springboot 类库 spring-boot-*.jar** 
>
> 您可以像使用任何标准Java库一样使用Spring Boot。 为此，请在您的类路径中包含相应的spring-boot-*.jar 文件。



#### maven installation

> **Spring Boot与Apache Maven 3.2或更高版本兼容。** 

* Spring Boot依赖使用org.springframework.boot groupId 。 通常，您的Maven POM文件从spring-boot-starter-parent 项目继承，并将依赖项声明为一个或多个“Starters” 。 Spring Boot还提供了一个可选的Maven plugin来创建可执行的jar。



* 一个典型的 pom.xml 文件：

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
      
  	<modelVersion>4.0.0</modelVersion>
      
      <groupId>com.example</groupId>
      <artifactId>myproject</artifactId>
      <version>0.0.1-SNAPSHOT</version>
      
      <!-- Inherit defaults from Spring Boot -->
      <parent>
      	<groupId>org.springframework.boot</groupId>
      	<artifactId>spring-boot-starter-parent</artifactId>
      	<version>2.0.3.RELEASE</version>
      </parent>
      
      <!-- Add typical dependencies for a web application -->
      <dependencies>
      	<dependency>
      	<groupId>org.springframework.boot</groupId>
      	<artifactId>spring-boot-starter-web</artifactId>
      	</dependency>
      </dependencies>
      
      <!-- Package as an executable jar -->
      <build>
          <plugins>
              <plugin>
                  <groupId>org.springframework.boot</groupId>
                  <artifactId>spring-boot-maven-plugin</artifactId>
              </plugin>
          </plugins>
      </build>
  </project>
  ```

  > spring-boot-starter-parent 是使用Spring Boot的好方法，但它可能并不适合所有的时间。 有时您可能需要从不同的父POM继承，或者您可能不喜欢我
  > 们的默认设置。 在这些情况下，请参阅Section 13.2.2, “Using Spring Boot without the Parent POM”了解使用**import 范围的替代解决方案。**

  

#### gradle installation





### installing the spring boot CLI

> Spring Boot CLI（命令行界面）是一个命令行工具，您可以使用它来快速使用Spring进行原型开发。 它可以让你运行Groovy脚本，这意味着你有一个熟悉的类Java语法，没有太多的样板代码。



#### manual installation

* 从Spring软件存储库下载Spring CLI分发版：
  * **spring-boot-cli-2.0.3.RELEASE-bin.zip**
  * **spring-boot-cli-2.0.3.RELEASE-bin.tar.gz**



#### installation with SDKMAN

* SDKMAN！ （软件开发工具包管理器）可用于管理各种二进制SDK的多个版本，包括Groovy和Spring Boot CLI。 获取SDKMAN！ 从sdkman.io并通过使用以下命令安装



### upgrading from an earlier version of spring boot

> If you are upgrading from an earlier release of Spring Boot, check the [“migration guide” on the project wiki](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide) that provides detailed upgrade instructions. Check also the[“release notes”](https://github.com/spring-projects/spring-boot/wiki) for a list of “new and noteworthy” features for each release.
>
> When upgrading to a new feature release, some properties may have been renamed or removed. Spring Boot provides a way to analyze your application’s environment and print diagnostics at startup, but also temporarily migrate properties at runtime for you. To enable that feature, add the following dependency to your project

```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-properties-migrator</artifactId>
	<scope>runtime</scope>
</dependency>
```



* 需要进行版本升级时需要注意版本更新的具体内容，新特性等
* 部分旧版本的配置或内容会被更名或者删除



> * Properties that are added late to the environment, such as when using `@PropertySource`, will not be taken into account.
> * Once you’re done with the migration, please make sure to remove this module from your project’s dependencies.



## developing your first spring boot application

> [spring.io](https://spring.io/) -> official documentation
>
> [getting started guides](https://spring.io/guides)  -> spring boot started ways of guides
>
> [start.spring.io](https://start.spring.io/)   -> shortcut the step to get started 



### creating the POM





### adding classpath dependencies

* 在项目根路径(有pom文件的目录)下运行指令，查看项目的依赖树

  ```shell
  mvn dependency:tree
  ```

  

* 编写测试代码

  ```java
  import org.springframework.boot.*;
  import org.springframework.boot.autoconfigure.*;
  import org.springframework.web.bind.annotation.*;
  
  @RestController
  @EnableAutoConfiguration
  public class Example {
  
  	@RequestMapping("/")
  	String home() {
  		return "Hello World!";
  	}
  
  	public static void main(String[] args) throws Exception {
  		SpringApplication.run(Example.class, args);
  	}
  
  }
  ```

  

* 在项目根路径(有pom文件的目录)下运行指令，启动项目

  ```shell
  mvn spring-boot:run
  ```

  

  

### creating an excutable jar

* Executable jars and Java 
  * `mvn package` ---> package project to jar
  * `jar tvf .\target\spring-boot-learn-starter-1.0-SNAPSHOT.jar` ---> show full content of  project jar
  * `java -jar .\target\spring-boot-learn-starter-1.0-SNAPSHOT.jar` ---> execute project jar

```shell
PS D:\projects\projects-microservices\spring-boot-learn\spring-boot-learn-starter> java -jar .\target\spring-boot-learn-starter-1.0-SNAPSHOT.jar

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.0.8.RELEASE)

2019-01-29 10:24:14.209  INFO 3776 --- [           main] com.jinm.learn.Example                   : Starting Example v1.0-SNAPSHOT on jinm with PID 3776 (D:\projects\projects-microservices\spring-boot-learn\spring-boot-learn-starter\target\spring-boot-learn-starter-1.0-SNAPSHOT.jar started by jinm in D:\projects\projects-microservices\spring-boot-learn\spring-boot-learn-starter)
```





# III. using spring boot



## build systems

* `maven` `gradle` ---> official recommend
* other build system, for example `ant` ---> are not well supported



### dependency management

* **use the default version of the dependencies**  

> * In practice, you do not need to provide a version for any of these dependencies in your build configuration, as Spring Boot manages that for you.
> * You can still specify a version and override Spring Boot’s recommendations if you need to do so.
> * Each release of Spring Boot is associated with a base version of the Spring Framework. We **highly** recommend that you not specify its version.



### maven

`spring-boot-starter-parent` project provides features:

* Java 1.8 as the default compiler level.
* UTF-8 source encoding.
* Dependency management lets you omit <version> tags for those dependencies when used in your own pom.
* Sensible [resource filtering](https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html).
* Sensible plugin configuration ([exec plugin](http://www.mojohaus.org/exec-maven-plugin/), [Git commit ID](https://github.com/ktoso/maven-git-commit-id-plugin), and [shade](https://maven.apache.org/plugins/maven-shade-plugin/)).
* Sensible resource filtering for `application.properties` and `application.yml` including profile-specific files (for example, `application-dev.properties` and`application-dev.yml`)



> **Note that, since the `application.properties` and `application.yml` files accept Spring style placeholders (`${…}`), the Maven filtering is changed to use `@..@`placeholders. (You can override that by setting a Maven property called `resource.delimiter`.)**



#### inheriting the starter parent



#### using Spring Boot without the Parent POM

```xml
<dependencyManagement>
	<dependencies>
		<!-- Override Spring Data release train provided by Spring Boot -->
		<dependency>
			<groupId>org.springframework.data</groupId>
			<artifactId>spring-data-releasetrain</artifactId>
			<version>Fowler-SR2</version>
			<type>pom</type>
			<scope>import</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-dependencies</artifactId>
			<version>2.0.8.RELEASE</version>
			<type>pom</type>
			<scope>import</scope>
		</dependency>
	</dependencies>
</dependencyManagement>
```



#### using the Spring Boot Maven Plugin

```xml
<build>
	<plugins>
		<plugin>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-maven-plugin</artifactId>
		</plugin>
	</plugins>
</build>
```



### starters



**Table 13.1. Spring Boot application starters**

| Name                                          | Description                                                  | Pom                                                          |
| --------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| `spring-boot-starter`                         | Core starter, including auto-configuration support, logging and YAML | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml) |
| `spring-boot-starter-activemq`                | Starter for JMS messaging using Apache ActiveMQ              | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml) |
| `spring-boot-starter-amqp`                    | Starter for using Spring AMQP and Rabbit MQ                  | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml) |
| `spring-boot-starter-aop`                     | Starter for aspect-oriented programming with Spring AOP and AspectJ | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml) |
| `spring-boot-starter-artemis`                 | Starter for JMS messaging using Apache Artemis               | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml) |
| `spring-boot-starter-batch`                   | Starter for using Spring Batch                               | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml) |
| `spring-boot-starter-cache`                   | Starter for using Spring Framework’s caching support         | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml) |
| `spring-boot-starter-cloud-connectors`        | Starter for using Spring Cloud Connectors which simplifies connecting to services in cloud platforms like Cloud Foundry and Heroku | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml) |
| `spring-boot-starter-data-cassandra`          | Starter for using Cassandra distributed database and Spring Data Cassandra | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml) |
| `spring-boot-starter-data-cassandra-reactive` | Starter for using Cassandra distributed database and Spring Data Cassandra Reactive | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml) |
| `spring-boot-starter-data-couchbase`          | Starter for using Couchbase document-oriented database and Spring Data Couchbase | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml) |
| `spring-boot-starter-data-couchbase-reactive` | Starter for using Couchbase document-oriented database and Spring Data Couchbase Reactive | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml) |
| `spring-boot-starter-data-elasticsearch`      | Starter for using Elasticsearch search and analytics engine and Spring Data Elasticsearch | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml) |
| `spring-boot-starter-data-jpa`                | Starter for using Spring Data JPA with Hibernate             | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml) |
| `spring-boot-starter-data-ldap`               | Starter for using Spring Data LDAP                           | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml) |
| `spring-boot-starter-data-mongodb`            | Starter for using MongoDB document-oriented database and Spring Data MongoDB | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml) |
| `spring-boot-starter-data-mongodb-reactive`   | Starter for using MongoDB document-oriented database and Spring Data MongoDB Reactive | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml) |
| `spring-boot-starter-data-neo4j`              | Starter for using Neo4j graph database and Spring Data Neo4j | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml) |
| `spring-boot-starter-data-redis`              | Starter for using Redis key-value data store with Spring Data Redis and the Lettuce client | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml) |
| `spring-boot-starter-data-redis-reactive`     | Starter for using Redis key-value data store with Spring Data Redis reactive and the Lettuce client | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml) |
| `spring-boot-starter-data-rest`               | Starter for exposing Spring Data repositories over REST using Spring Data REST | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml) |
| `spring-boot-starter-data-solr`               | Starter for using the Apache Solr search platform with Spring Data Solr | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml) |
| `spring-boot-starter-freemarker`              | Starter for building MVC web applications using FreeMarker views | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml) |
| `spring-boot-starter-groovy-templates`        | Starter for building MVC web applications using Groovy Templates views | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml) |
| `spring-boot-starter-hateoas`                 | Starter for building hypermedia-based RESTful web application with Spring MVC and Spring HATEOAS | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml) |
| `spring-boot-starter-integration`             | Starter for using Spring Integration                         | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml) |
| `spring-boot-starter-jdbc`                    | Starter for using JDBC with the HikariCP connection pool     | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml) |
| `spring-boot-starter-jersey`                  | Starter for building RESTful web applications using JAX-RS and Jersey. An alternative to [`spring-boot-starter-web`](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#spring-boot-starter-web) | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml) |
| `spring-boot-starter-jooq`                    | Starter for using jOOQ to access SQL databases. An alternative to [`spring-boot-starter-data-jpa`](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#spring-boot-starter-data-jpa) or [`spring-boot-starter-jdbc`](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#spring-boot-starter-jdbc) | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml) |
| `spring-boot-starter-json`                    | Starter for reading and writing json                         | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml) |
| `spring-boot-starter-jta-atomikos`            | Starter for JTA transactions using Atomikos                  | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml) |
| `spring-boot-starter-jta-bitronix`            | Starter for JTA transactions using Bitronix                  | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml) |
| `spring-boot-starter-jta-narayana`            | Starter for JTA transactions using Narayana                  | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-narayana/pom.xml) |
| `spring-boot-starter-mail`                    | Starter for using Java Mail and Spring Framework’s email sending support | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml) |
| `spring-boot-starter-mustache`                | Starter for building web applications using Mustache views   | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml) |
| `spring-boot-starter-quartz`                  | Starter for using the Quartz scheduler                       | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml) |
| `spring-boot-starter-security`                | Starter for using Spring Security                            | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml) |
| `spring-boot-starter-test`                    | Starter for testing Spring Boot applications with libraries including JUnit, Hamcrest and Mockito | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml) |
| `spring-boot-starter-thymeleaf`               | Starter for building MVC web applications using Thymeleaf views | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml) |
| `spring-boot-starter-validation`              | Starter for using Java Bean Validation with Hibernate Validator | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml) |
| `spring-boot-starter-web`                     | Starter for building web, including RESTful, applications using Spring MVC. Uses Tomcat as the default embedded container | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml) |
| `spring-boot-starter-web-services`            | Starter for using Spring Web Services                        | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml) |
| `spring-boot-starter-webflux`                 | Starter for building WebFlux applications using Spring Framework’s Reactive Web support | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml) |
| `spring-boot-starter-websocket`               | Starter for building WebSocket applications using Spring Framework’s WebSocket support | [Pom](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml) |



## structuring your code

### using the "default" package

> We recommend that you follow Java’s recommended package naming conventions and use a reversed domain name (for example, `com.example.project`).



### locating the Main Application Class

>  We generally recommend that you locate your main application class in a root package above other classes

* official recommend layout

  ```java
  com
   +- example
       +- myapplication
           +- Application.java
           |
           +- customer
           |   +- Customer.java
           |   +- CustomerController.java
           |   +- CustomerService.java
           |   +- CustomerRepository.java
           |
           +- order
               +- Order.java
               +- OrderController.java
               +- OrderService.java
               +- OrderRepository.java
  ```

  

* The `Application.java` file would declare the `main` method, along with the basic `@SpringBootApplication`, as follows:

  ```java
  package com.example.myapplication;
  
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  
  @SpringBootApplication
  public class Application {
  
  	public static void main(String[] args) {
  		SpringApplication.run(Application.class, args);
  	}
  
  }
  ```

  



## configuration classes

* as little as possible use `SpringApplication` with XML
* recommend primary source be a  `@Configuration` class
* good candidate: use the primary  `@Configuration` to the class that defines the `main` method
*  `Enable*` annotations work better, as Java-based configuration (for instance:XML)



### Importing Additional Configuration Classes

* `@Import` 
  * put all your  `@Configuration` into a single class
  * `@Import` annotation can be use to import additional configuration classes
*  `@ComponentScan` 
  * do the same things just like `@Import` , alternatively
  * use `@ComponentScan` to automatically pick up all Spring components, including `@Configuration` classes.

#### importing XML configuration

*  `@ImportResource` 
  * this annotation to load XML configuration files, if you absolutely must use XML based configuration.
  * recommend: still start with a  `@Configuration` class, add  `@ImportResource` annotation to this class



## Auto-configuration

*  `@EnableAutoConfiguration` or  `@SpringBootApplication` 
  * recommend you to add  one  or the other to your primary  `@Configuration` class only.



#### Gradually Replacing Auto-configuration

* Auto-configuration is non-invasive. 
  *  define your own configuration to replace specific parts of the auto-configuration
* start application with the `--debug` switch.
  *  find out what auto-configuration is currently being applied, and why
  * Doing so enables debug logs for a selection of core loggers and logs a conditions report to the console.



#### Disabling Specific Auto-configuration Classes

* use the `exclude` attribute of `@EnableAutoConfiguration` to disable specific auto-configuration classes

  * `exclude ` attribute 

    ```java
    import org.springframework.boot.autoconfigure.*;
    import org.springframework.boot.autoconfigure.jdbc.*;
    import org.springframework.context.annotation.*;
    
    @Configuration
    @EnableAutoConfiguration(exclude={DataSourceAutoConfiguration.class})
    public class MyConfiguration {
    }
    ```

  *  `excludeName`  attribute 

    * If the class is not on the classpath, you can use the `excludeName` attribute of the annotation and specify the fully qualified name instead. 

  *  `spring.autoconfigure.exclude`  property

    * control the list of auto-configuration classes to exclude 

* >  You can define exclusions both at the annotation level and by using the property.



## Spring Beans and Dependency Injection

* `@ComponentScan` ---> to find your beans

  * add `@ComponentScan` without any arguments, if your application class located in a root package.
*  `@Autowired`  --->  to do constructor injection
* All of your application components (`@Component`, `@Service`, `@Repository`, `@Controller` etc.) are automatically registered as Spring Beans.

* eg.

  *  a `@Service` Bean that uses constructor injection to obtain a required `RiskAssessor` bean:

    ```java
    package com.example.service;
    
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;
    
    @Service
    public class DatabaseAccountService implements AccountService {
    
    	private final RiskAssessor riskAssessor;
    
    	@Autowired
    	public DatabaseAccountService(RiskAssessor riskAssessor) {
    		this.riskAssessor = riskAssessor;
    	}
    
    	// ...
    
    }
    ```

  * If a bean has one constructor, you can omit the `@Autowired`, as shown in the following example:

    ```java
    @Service
    public class DatabaseAccountService implements AccountService {
    
    	private final RiskAssessor riskAssessor;
    
    	public DatabaseAccountService(RiskAssessor riskAssessor) {
    		this.riskAssessor = riskAssessor;
    	}
    
    	// ...
    
    }
    ```

    

## Using the @SpringBootApplication Annotation

* `@SpringBootApplication` annotation enable three features:
  * `@EnableAutoConfiguration`: enable [Spring Boot's auto-configuration mechanism](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-auto-configuration)
  * `@ComponentScan`: enable `@Component` scan on the package where the application is located (see [the best practices](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-structuring-your-code))
  * `@Configuration`: allow to register extra beans in the context or import additional configuration classes

* The `@SpringBootApplication` annotation is equivalent to using `@Configuration`, `@EnableAutoConfiguration`, and `@ComponentScan` with their default attributes

  ```java
  package com.example.myapplication;
  
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  
  @SpringBootApplication // same as @Configuration @EnableAutoConfiguration @ComponentScan
  public class Application {
  
  	public static void main(String[] args) {
  		SpringApplication.run(Application.class, args);
  	}
  
  }
  ```

  

* > `@SpringBootApplication` also provides aliases to customize the attributes of `@EnableAutoConfiguration` and `@ComponentScan`.

* > None of these features are mandatory and you may choose to replace this single annotation by any of the features that it enables.

  ```java
  package com.example.myapplication;
  
  import org.springframework.boot.SpringApplication;
  import org.springframework.context.annotation.ComponentScan
  import org.springframework.context.annotation.Configuration;
  import org.springframework.context.annotation.Import;
  
  // use import to replace component-scan 
  
  @Configuration
  @EnableAutoConfiguration
  @Import({ MyConfig.class, MyAnotherConfig.class })
  public class Application {
  
  	public static void main(String[] args) {
  			SpringApplication.run(Application.class, args);
  	}
  
  }
  ```

  

## Running Your Application

> *  you can run your application as you would any other
>   * packaging your application as a jar 
>   *  using an embedded HTTP server 



#### Running as a Packaged Application

* `java -jar` ---> use the Spring Boot `Maven` or `Gradle` plugins to create an executable jar

  ```shell
  $ java -jar target/myapplication-0.0.1-SNAPSHOT.jar
  ```

* remote debugging

  ```shell
  $ java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,suspend=n \
         -jar target/myapplication-0.0.1-SNAPSHOT.jar
  ```



#### Using the Maven Plugin

> The Spring Boot Maven plugin includes a `run` goal that can be used to quickly compile and run your application

*  run a Spring Boot application:

  ```shell
  $ mvn spring-boot:run
  ```

*  use the `MAVEN_OPTS` operating system environment variable

  ```shell
  $ export MAVEN_OPTS=-Xmx1024m
  ```

  

#### Hot Swapping

* [`JRebel`](https://zeroturnaround.com/software/jrebel/) 
  * recommend to solve problem: JVM hot swapping is somewhat limited with the bytecode that it can replace.

*  [*Developer Tools*](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-devtools) 
  * The `spring-boot-devtools` module also includes support for quick application restarts



##  Developer Tools

* The `spring-boot-devtools` module can be included in any project to provide additional development-time features.

*  the module dependency to your build:

  ```xml
  <dependencies>
  	<dependency>
  		<groupId>org.springframework.boot</groupId>
  		<artifactId>spring-boot-devtools</artifactId>
  		<optional>true</optional>
  	</dependency>
  </dependencies>
  ```

  

#### Property Defaults

* Several of the libraries supported by Spring Boot use caches to improve performance.
  *  [template engines](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-template-engines) cache compiled templates to avoid repeatedly parsing template files
  * `Spring MVC` can add HTTP caching headers to responses when serving static resources.
*  spring-boot-devtools disables the caching options by default.
  * While caching is very beneficial in production, it can be counter-productive during development, preventing you from seeing the changes you just made in your application.
* Cache options are usually configured by settings in your `application.properties` file. 
  * `Thymeleaf` offers the `spring.thymeleaf.cache` property. 
  * the `spring-boot-devtools` module automatically applies sensible development-time configuration to set these properties manually

*  [DevToolsPropertyDefaultsPostProcessor](https://github.com/spring-projects/spring-boot/tree/v2.0.8.RELEASE/spring-boot-project/spring-boot-devtools/src/main/java/org/springframework/boot/devtools/env/DevToolsPropertyDefaultsPostProcessor.java).
  * a complete list of the properties that are applied by the devtools



#### Automatic Restart

* summary
  * Applications that use `spring-boot-devtools` automatically restart whenever files on the classpath change. 
  * By default, any entry on the classpath that points to a folder is monitored for changes. 
  * Note that certain resources, such as static assets and view templates, [do not need to restart the application](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-devtools-restart-exclude).

* `Restart` vs `Reload` 
  * `a base classloader` ---> Classes that do not change (for example, those from third-party jars) are loaded 
    * When the application is restarted, the *restart* classloader is thrown away and a new one is created
  * `a restart classloader` --->  Classes that you are actively developing are loaded



##### Logging changes in condition evaluation

* logging the changes to your application’s auto-configuration as you make changes such as adding or removing beans and setting configuration properties.

* property To disable the logging of the report:

  ```xml
  spring.devtools.restart.log-condition-evaluation-delta=false
  ```

  

##### Excluding Resources

* [live reload](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-devtools-livereload) 

  * By default, changing resources in `/META-INF/maven`, `/META-INF/resources`, `/resources`, `/static`, `/public`, or `/templates` does not trigger a restart but does trigger a [live reload](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-devtools-livereload). 

*  customize exclusions --->  For example, to exclude only `/static` and `/public` you would set the property:

  ```xml
  spring.devtools.restart.exclude=static/**,public/**
  ```

* *add* additional exclusions

  ```xml
  spring.devtools.restart.additional-exclude
  ```

  

### Watching Additional Paths

*  make changes to files that are not on the classpath for restarting and reloading

  ```xml
  spring.devtools.restart.additional-paths
  ```

  

### Disabling Restart

using the `spring.devtools.restart.enabled` to disable restart feature.

* set this property in `application.properties` 

  * doing so still initializes the restart classloader, but it does not watch for file changes

* set `System` property to `false` before calling `SpringApplication.run(…)` 

  * *completely* disable restart support: 

    ```java
    public static void main(String[] args) {
    	System.setProperty("spring.devtools.restart.enabled", "false");
    	SpringApplication.run(MyApp.class, args);
    }
    ```



### Using a Trigger File

trigger restarts only at specific times , set the property: `spring.devtools.restart.trigger-file` 

* set the property to the specific  path of your trigger file
* set the property as [global setting](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-devtools-globalsettings) 



### Customizing the Restart Classloader

* The `spring-devtools.properties` file 
  * By default, any open project in your IDE is loaded with the “restart” classloader, and any regular `.jar` file is loaded with the “base” classloader. If you work on a multi-module project, and not every module is imported into your IDE, you may need to customize things. To do so, you can create a `META-INF/spring-devtools.properties` file.

  * this file contains properties prefixed with `restart.exclude` and `restart.include` 

    * The `include` elements are items that should be pulled up into the “restart” `classloader` 
    * the `exclude` elements are items that should be pushed down into the “base” `classloader` 
    * The value of the property is a `regex`  pattern that is applied to the `classpath` 

    ```properties
    restart.exclude.companycommonlibs=/mycorp-common-[\\w-]+\.jar
    restart.include.projectcommon=/mycorp-myproj-[\\w-]+\.jar
    ```

  * All property keys must be unique. As long as a property starts with `restart.include.` or `restart.exclude.` it is considered.

  * All `META-INF/spring-devtools.properties` from the classpath are loaded. You can package files inside your project, or in the libraries that the project consumes.



### Known Limitations

Restart functionality does not work well with objects that are `deserialized` by using a standard `ObjectInputStream`. use Spring’s `ConfigurableObjectInputStream` in combination with `Thread.currentThread().getContextClassLoader()`.



### `LiveReload`

The `spring-boot-devtools` module includes an embedded `LiveReload` server that can be used to trigger a browser refresh when a resource is changed. 



### Global Settings

You can configure global `devtools` settings by adding a file named `.spring-boot-devtools.properties` to your `$HOME` folder (note that the filename starts with “.”). 



### Remote Applications

Remote `devtools` support is provided in two parts: a server-side endpoint that accepts connections and a client application that you run in your `IDE`. 

*  to make sure that `devtools` is included in the repackaged archive

  ```xml
  <build>
  	<plugins>
  		<plugin>
  			<groupId>org.springframework.boot</groupId>
  			<artifactId>spring-boot-maven-plugin</artifactId>
  			<configuration>
  				<excludeDevtools>false</excludeDevtools>
  			</configuration>
  		</plugin>
  	</plugins>
  </build>
  ```

* to set a `spring.devtools.remote.secret` property

  ```pro
  spring.devtools.remote.secret=mysecret
  ```



## Packaging Your Application for Production



# IV. Spring Boot features

## `SpringApplication` 

* The `SpringApplication` class provides a convenient way to bootstrap a Spring application that is started from a `main()` method.

  ```java
  public static void main(String[] args) {
  	SpringApplication.run(MySpringConfiguration.class, args);
  }
  ```

* modify log levels: as described in [Section 26.4, “Log Levels”](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-custom-log-levels) 



### Startup Failure

*  to [enable the `debug` property](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-external-config) or [enable `DEBUG` logging](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-custom-log-levels) for `org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener`.

  * display the full conditions report to better understand what went wrong

    ```shell
    $ java -jar myproject-0.0.1-SNAPSHOT.jar --debug
    ```



### Customizing the Banner



### Customizing SpringApplication

If the `SpringApplication` defaults are not to your taste, you can instead create a local instance and customize it. 

* For example, to turn off the banner

  ```java
  public static void main(String[] args) {
  	SpringApplication app = new SpringApplication(MySpringConfiguration.class);
  	app.setBannerMode(Banner.Mode.OFF);
  	app.run(args);
  }
  ```



###  Fluent Builder API

* The `SpringApplicationBuilder` lets you chain together multiple method calls and includes `parent` and `child` methods that let you create a hierarchy:

  ```java
  new SpringApplicationBuilder()
  		.sources(Parent.class)
  		.child(Application.class)
  		.bannerMode(Banner.Mode.OFF)
  		.run(args);
  ```



### Application Events and Listeners

* Some events are actually triggered before the `ApplicationContext` is created, so you cannot register a listener on those as a `@Bean` , so use following:

  *  `SpringApplication.addListeners(…)` 
  *  `SpringApplicationBuilder.listeners(…)` 

* register listeners those were triggered before `ApplicationContext` has been created

  * add file:  `META-INF/spring.factories` 

  * add content:  `org.springframework.context.ApplicationListener` 

    ```properties
    org.springframework.context.ApplicationListener=com.example.project.MyListener
    ```

* You often need not use application events, but it can be handy to know that they exist. Internally, Spring Boot uses events to handle a variety of tasks.

* Application events are sent in the following order, as your application runs:

> 1. An `ApplicationStartingEvent` is sent at the start of a run but before any processing, except for the registration of listeners and initializers.
> 2. An `ApplicationEnvironmentPreparedEvent` is sent when the `Environment` to be used in the context is known but before the context is created.
> 3. An `ApplicationPreparedEvent` is sent just before the refresh is started but after bean definitions have been loaded.
> 4. An `ApplicationStartedEvent` is sent after the context has been refreshed but before any application and command-line runners have been called.
> 5. An `ApplicationReadyEvent` is sent after any application and command-line runners have been called. It indicates that the application is ready to service requests.
> 6. An `ApplicationFailedEvent` is sent if there is an exception on startup.



### Web Environment

* A `SpringApplication` attempts to create the right type of `ApplicationContext` on your behalf. The algorithm used to determine a `WebApplicationType` is fairly simple:

  > - If Spring MVC is present, an `AnnotationConfigServletWebServerApplicationContext` is used
  > - If Spring MVC is not present and Spring WebFlux is present, an `AnnotationConfigReactiveWebServerApplicationContext` is used
  > - Otherwise, `AnnotationConfigApplicationContext` is used

* This means that if you are using Spring MVC and the new `WebClient` from Spring WebFlux in the same application, Spring MVC will be used by default. You can override that easily by calling `setWebApplicationType(WebApplicationType)`.

  * It is often desirable to call `setWebApplicationType(WebApplicationType.NONE)` when using `SpringApplication` within a JUnit test.
* It is also possible to take complete control of the `ApplicationContext` type that is used by calling `setApplicationContextClass(…)`.



### Accessing Application Arguments

* Spring Boot also registers a `CommandLinePropertySource` with the Spring `Environment`. This lets you also inject single application arguments by using the `@Value` annotation.



### Using the ApplicationRunner or CommandLineRunner

* If you need to run some specific code once the `SpringApplication` has started, you can implement the `ApplicationRunner` or `CommandLineRunner` interfaces. Both interfaces work in the same way and offer a single `run` method, which is called just before `SpringApplication.run(…)` completes.

* The `CommandLineRunner` interfaces provides access to application arguments as a simple string array, whereas the `ApplicationRunner` uses the `ApplicationArguments` interface discussed earlier. 



### Application Exit

* Each `SpringApplication` registers a shutdown hook with the JVM to ensure that the `ApplicationContext` closes gracefully on exit. 

* In addition, beans may implement the `org.springframework.boot.ExitCodeGenerator` interface if they wish to return a specific exit code when `SpringApplication.exit()` is called.

  ```java
  @SpringBootApplication
  public class ExitCodeApplication {
  
  	@Bean
  	public ExitCodeGenerator exitCodeGenerator() {
  		return () -> 42;
  	}
  
  	public static void main(String[] args) {
  		System.exit(SpringApplication
  				.exit(SpringApplication.run(ExitCodeApplication.class, args)));
  	}
  
  }
  ```

* the `ExitCodeGenerator` interface may be implemented by exceptions.

  * Spring Boot returns the exit code provided by the implemented `getExitCode()` method.



## Externalized Configuration

* Spring Boot lets you externalize your configuration so that you can work with the same application code in different environments.
* Use properties files, YAML files, environment variables, and command-line arguments to externalize configuration. 
* Property values can be injected directly into your beans by using the `@Value`annotation, accessed through Spring’s `Environment` abstraction, or be [bound to structured objects](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-external-config-typesafe-configuration-properties) through `@ConfigurationProperties`.

* Spring Boot uses a very particular `PropertySource` order that is designed to allow sensible overriding of values:

  > 1. [Devtools global settings properties](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#using-boot-devtools-globalsettings) on your home directory (`~/.spring-boot-devtools.properties` when devtools is active).
  > 2. [`@TestPropertySource`](https://docs.spring.io/spring/docs/5.0.12.RELEASE/javadoc-api/org/springframework/test/context/TestPropertySource.html) annotations on your tests.
  > 3. [`@SpringBootTest#properties`](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/api/org/springframework/boot/test/context/SpringBootTest.html) annotation attribute on your tests.
  > 4. Command line arguments.
  > 5. Properties from `SPRING_APPLICATION_JSON` (inline JSON embedded in an environment variable or system property).
  > 6. `ServletConfig` init parameters.
  > 7. `ServletContext` init parameters.
  > 8. JNDI attributes from `java:comp/env`.
  > 9. Java System properties (`System.getProperties()`).
  > 10. OS environment variables.
  > 11. A `RandomValuePropertySource` that has properties only in `random.*`.
  > 12. [Profile-specific application properties](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties) outside of your packaged jar (`application-{profile}.properties` and YAML variants).
  > 13. [Profile-specific application properties](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties) packaged inside your jar (`application-{profile}.properties` and YAML variants).
  > 14. Application properties outside of your packaged jar (`application.properties` and YAML variants).
  > 15. Application properties packaged inside your jar (`application.properties` and YAML variants).
  > 16. [`@PropertySource`](https://docs.spring.io/spring/docs/5.0.12.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html) annotations on your `@Configuration` classes.
  > 17. Default properties (specified by setting `SpringApplication.setDefaultProperties`).



###  Configuring Random Values

The `RandomValuePropertySource` is useful for injecting random values

```properties
my.secret=${random.value}
my.number=${random.int}
my.bignumber=${random.long}
my.uuid=${random.uuid}
my.number.less.than.ten=${random.int(10)}
my.number.in.range=${random.int[1024,65536]}
```



### Accessing Command Line Properties

* By default, `SpringApplication` converts any command line option arguments (that is, arguments starting with `--`, such as `--server.port=9000`) to a `property`and adds them to the Spring `Environment`. 

* If you do not want command line properties to be added to the `Environment`, you can disable them by using `SpringApplication.setAddCommandLineProperties(false)`.



### Application Property Files

* `SpringApplication` loads properties from `application.properties` files in the following locations and adds them to the Spring `Environment`:

  > 1. A `/config` subdirectory of the current directory
  > 2. The current directory
  > 3. A classpath `/config` package
  > 4. The classpath root

* `spring.config.name` and `spring.config.location` ---> to determine which files have to be loaded

  * If you do not like `application.properties` as the configuration file name, you can switch to another file name by specifying a `spring.config.name` environment property. 

    ```shell
    $ java -jar myproject.jar --spring.config.name=myproject
    ```

  * You can also refer to an explicit location by using the `spring.config.location` environment property (which is a comma-separated list of directory locations or file paths). 

    ```shell
    $ java -jar myproject.jar --spring.config.location=classpath:/default.properties,classpath:/override.properties
    ```

  * If `spring.config.location` contains directories (as opposed to files), they should end in `/` 

* Config locations are searched in reverse order. By default, the configured locations are `classpath:/,classpath:/config/,file:./,file:./config/`. The resulting search order is the following:

  > 1. `file:./config/`
  > 2. `file:./`
  > 3. `classpath:/config/`
  > 4. `classpath:/`

* Alternatively, when custom config locations are configured by using `spring.config.additional-location`, they are used in addition to the default locations. Additional locations are searched before the default locations. For example, if additional locations of `classpath:/custom-config/,file:./custom-config/` are configured, the search order becomes the following:

  > 1. `file:./custom-config/`
  > 2. `classpath:custom-config/`
  > 3. `file:./config/`
  > 4. `file:./`
  > 5. `classpath:/config/`
  > 6. `classpath:/`



### Profile-specific Properties

* `application-{profile}.properties`. The `Environment` has a set of default profiles (by default, `[default]`) that are used if no active profiles are set. In other words, if no profiles are explicitly activated, then properties from `application-default.properties` are loaded.
* Profile-specific properties are loaded from the same locations as standard `application.properties`, with profile-specific files always overriding the non-specific ones, whether or not the profile-specific files are inside or outside your packaged jar.
* If several profiles are specified, a last-wins strategy applies. For example, profiles specified by the `spring.profiles.active` property are added after those configured through the `SpringApplication` API and therefore take precedence.



### Placeholders in Properties

The values in `application.properties` are filtered through the existing `Environment` when they are used, so you can refer back to previously defined values



### Encrypting Properties

* Spring Boot does not provide any built in support for encrypting property values, however, it does provide the hook points necessary to modify values contained in the Spring `Environment`. The `EnvironmentPostProcessor` interface allows you to manipulate the `Environment` before the application starts.

* If you’re looking for a secure way to store credentials and passwords, the [Spring Cloud Vault](https://cloud.spring.io/spring-cloud-vault/) project provides support for storing externalized configuration in [HashiCorp Vault](https://www.vaultproject.io/).



### Using `YAML` Instead of Properties

[YAML](http://yaml.org/) is a superset of `JSON` and, as such, is a convenient format for specifying hierarchical configuration data. The `SpringApplication` class automatically supports `YAML` as an alternative to properties whenever you have the [SnakeYAML](http://www.snakeyaml.org/) library on your `classpath`.



####  Loading `YAML` 

The `YamlPropertiesFactoryBean` loads `YAML` as `Properties` and the `YamlMapFactoryBean` loads `YAML` as a `Map`.

* transformed 
  * `YAML` document:

    ```yaml
    environments:
    	dev:
    		url: http://dev.example.com
    		name: Developer Setup
    	prod:
    		url: http://another.example.com
    		name: My Cool App
    ```

  * into the properties:

    ```properties
    environments.dev.url=http://dev.example.com
    environments.dev.name=Developer Setup
    environments.prod.url=http://another.example.com
    environments.prod.name=My Cool App
    ```

* `YAML` lists are represented as property keys with `[index]` dereferencers.

  * `YAML`:

    ```yaml
    my:
    servers:
    	- dev.example.com
    	- another.example.com
    ```

  * transformed into these properties:

    ```properties
    my.servers[0]=dev.example.com
    my.servers[1]=another.example.com
    ```

* To bind to properties like that by using Spring Boot’s `Binder` utilities (which is what `@ConfigurationProperties` does), you need to have a property in the target bean of type `java.util.List` (or `Set`) and you either need to provide a setter or initialize it with a mutable value. 

  ```java
  @ConfigurationProperties(prefix="my")
  public class Config {
  
  	private List<String> servers = new ArrayList<String>();
  
  	public List<String> getServers() {
  		return this.servers;
  	}
  }
  ```



#### Exposing YAML as Properties in the Spring Environment

The `YamlPropertySourceLoader` class can be used to expose YAML as a `PropertySource` in the Spring `Environment`. Doing so lets you use the `@Value`annotation with placeholders syntax to access YAML properties.



#### Multi-profile YAML Documents

* specify multiple profile-specific YAML documents in a single file by using a `spring.profiles` key to indicate when the document applies

  ```yaml
  server:
  	address: 192.168.1.100
  ---
  spring:
  	profiles: development
  server:
  	address: 127.0.0.1
  ---
  spring:
  	profiles: production
  server:
  	address: 192.168.1.120
  ```

  * `development` profile is active, the `server.address` property is `127.0.0.1`. 
  * `production` profile is active, the`server.address` property is `192.168.1.120`.
  * `development` and `production` profiles are **not** enabled, then the value for the property is `192.168.1.100`.

* If none are explicitly active when the application context starts, the default profiles are activated. So, in the following YAML, we set a value for `spring.security.user.password` that is available **only** in the "default" profile:

  ```yaml
  server:
    port: 8000
  ---
  spring:
    profiles: default
    security:
      user:
        password: weak
  ```

  * the password is always set because it is not attached to any profile, and it would have to be explicitly reset in all other profiles as necessary:

    ```yaml
    server:
      port: 8000
    spring:
      security:
        user:
          password: weak
    ```



#### YAML Shortcomings

YAML files cannot be loaded by using the `@PropertySource` annotation. So, in the case that you need to load values that way, you need to use a properties file.





## Profiles

Any `@Component` or `@Configuration` can be marked with `@Profile` to limit when it is loaded



#### Adding Active Profiles

* The `spring.profiles.active` property follows the same ordering rules as other properties: The highest `PropertySource` wins. This means that you can specify active profiles in `application.properties` and then **replace** them by using the command line switch.

* The `spring.profiles.include` property can be used to unconditionally add active profiles. The `SpringApplication` entry point also has a Java API for setting additional profiles (that is, on top of those activated by the`spring.profiles.active` property). See the `setAdditionalProfiles()` method in [SpringApplication](https://docs.spring.io/spring-boot/docs/2.0.8.RELEASE/api/org/springframework/boot/SpringApplication.html).

  *  when an application with the following properties is run by using the switch, `--spring.profiles.active=prod`, the `proddb` and `prodmq` profiles are also activated:

    ```yaml
    ---
    my.property: fromyamlfile
    ---
    spring.profiles: prod
    spring.profiles.include:
      - proddb
      - prodmq
    ```





























